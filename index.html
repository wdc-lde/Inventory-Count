<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Warehouse Item/Location Scanner</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    body { font-family: Arial; margin:20px;background:#f5f5f5; }
    h2{margin-bottom:5px;} h3{margin:0 0 15px;font-weight:bold;color:#07459C;}
    .container{max-width:600px;margin:auto;background:#fff;padding:20px;border-radius:4px;box-shadow:0 0 10px rgba(0,0,0,0.1);}
    .hidden{display:none!important}
    #scanInput{width:100%;padding:10px;font-size:1.1em;margin-bottom:8px}
    #dataTableContainer{max-height:200px;overflow-y:auto;margin-bottom:10px;border:1px solid #ccc}
    th,td{padding:8px;border-bottom:1px solid #ddd;text-align:left}
    #dataTable thead th{position:sticky;top:0;background:#fff;z-index:5}
    button{cursor:pointer}
    .error{color:red;margin-bottom:10px}
    .info{margin-bottom:10px}

    .controlBtn{width:80px;height:40px;border-radius:4px;border:none;padding:0;display:flex;justify-content:center;align-items:center;background:#ccc;color:#fff;font-size:14px;margin:5px auto}
    .controlBtn:disabled{background:#ccc}

    #quantityContainer{text-align:center;margin-bottom:10px}
    #quantityDisplay{font-size:2em;margin-bottom:10px}
    .keypad{display:grid;grid-template-columns:repeat(3,1fr);gap:10px;max-width:300px;margin:auto}
    .keypad button{font-size:1.5em;padding:15px;background:#e0e0e0;border:none;border-radius:4px;display:flex;justify-content:center;align-items:center}
    #delKey{background:red;color:#fff} #enterKey{background:#8EFF26;color:#fff}
    .keypad svg{width:1em;height:1em;stroke:currentColor;stroke-width:4;fill:none}
  </style>
</head>
<body>

<div id="userInfoContainer" class="container">
  <h2>Warehouse Item / Location Scanner</h2>
  <h3>Inventory Count</h3>
  <div><label>User Name:</label><input id="userName" type="text"></div>
  <div><label>Warehouse Zone:</label><input id="warehouseZone" type="text"></div>
  <button id="startBtn">Start</button>
</div>

<div id="mainApp" class="container hidden">
  <div class="info"><strong>User:</strong> <span id="displayName"></span> | <strong>Warehouse Zone:</strong> <span id="displayZone"></span></div>
  <div id="errorMessage" class="error"></div>

  <input id="scanInput" placeholder="Scan/Type Item" type="text">
  <button id="triggerEnterBtn" class="controlBtn" disabled>
    <svg viewBox="0 0 24 24" style="width:20px;height:20px"><polyline points="20 6 9 17 4 12" fill="none" stroke="white" stroke-width="4"/></svg>
  </button>

  <div id="quantityContainer" class="hidden">
    <div id="quantityDisplay">0</div>
    <div class="keypad">
      <button class="numKey">1</button><button class="numKey">2</button><button class="numKey">3</button>
      <button class="numKey">4</button><button class="numKey">5</button><button class="numKey">6</button>
      <button class="numKey">7</button><button class="numKey">8</button><button class="numKey">9</button>
      <button id="delKey"><svg viewBox="0 0 24 24"><polyline points="15 6 9 12 15 18"/></svg></button>
      <button class="numKey">0</button>
      <button id="enterKey"><svg viewBox="0 0 24 24"><polyline points="20 6 9 17 4 12"/></svg></button>
    </div>
  </div>

  <div id="dataTableContainer">
    <table id="dataTable"><thead><tr>
      <th>Item</th><th>Location</th><th>Quantity</th><th>Action</th>
    </tr></thead><tbody></tbody></table>
  </div>
  <button id="exportCSV">Export to CSV</button>
</div>

<script>
let currentState='item',currentItem='',tempLocation='',rawQuantity='',
scannedData=JSON.parse(localStorage.getItem('scannedData')||'[]');

const startBtn=document.getElementById('startBtn'),
userInfoContainer=document.getElementById('userInfoContainer'),
mainApp=document.getElementById('mainApp'),
scanInput=document.getElementById('scanInput'),
triggerEnterBtn=document.getElementById('triggerEnterBtn'),
quantityContainer=document.getElementById('quantityContainer'),
quantityDisplay=document.getElementById('quantityDisplay'),
numKeys=document.querySelectorAll('.numKey'),delKey=document.getElementById('delKey'),
enterKey=document.getElementById('enterKey'),
errorMessage=document.getElementById('errorMessage'),
dataTableBody=document.querySelector('#dataTable tbody'),
displayName=document.getElementById('displayName'),
displayZone=document.getElementById('displayZone');

function formatNumber(v){return v?v.replace(/\B(?=(\d{3})+(?!\d))/g,','):0;}
function updateDisplay(){quantityDisplay.textContent=formatNumber(rawQuantity);}
function saveData(){localStorage.setItem('scannedData',JSON.stringify(scannedData));}
function clearInput(){
  scanInput.value='';triggerEnterBtn.disabled=true;triggerEnterBtn.style.background='#ccc';scanInput.focus();
}
function loadTable(){
 dataTableBody.innerHTML='';
 scannedData.forEach((e,i)=>{
   dataTableBody.innerHTML+=`<tr><td>${e.item}</td><td>${e.location}</td><td>${formatNumber(e.quantity+"")}</td>
   <td><button data-index="${i}" class="deleteRow">Delete</button></td></tr>`;
 });
 document.getElementById('dataTableContainer').scrollTop=document.getElementById('dataTableContainer').scrollHeight;
}
function showError(field){
  errorMessage.textContent = field==='Item'
    ? 'Data error, scan \"Item\" barcode'
    : 'Data error, scan \"Location\" QR code';
  setTimeout(()=>errorMessage.textContent='',3000);
}

startBtn.addEventListener('click',()=>{
 const userName=document.getElementById('userName').value.trim(),
       warehouseZone=document.getElementById('warehouseZone').value.trim();
 if(!userName||!warehouseZone) return alert('Please fill both fields.');
 displayName.textContent=userName;displayZone.textContent=warehouseZone;
 userInfoContainer.classList.add('hidden');
 mainApp.classList.remove('hidden');
 loadTable();clearInput();
});

triggerEnterBtn.addEventListener('click',()=>{if(!triggerEnterBtn.disabled) scanInput.dispatchEvent(new KeyboardEvent('keydown',{key:'Enter'}));});
scanInput.addEventListener('input',()=>{
 triggerEnterBtn.disabled=scanInput.value.trim()==='';
 triggerEnterBtn.style.background=triggerEnterBtn.disabled?'#ccc':'#8EFF26';
});

scanInput.addEventListener('keydown',e=>{
 if(e.key==='Enter'){e.preventDefault();
   let v=scanInput.value.trim();
   if(currentState==='item'){
     if(!v||/^\d+$/.test(v)){showError('Item');return clearInput();}
     currentItem=v;currentState='location';scanInput.placeholder='Scan/Type Location (Only numeric)';return clearInput();
   }
   if(currentState==='location'){
     if(!currentItem){showError('Item');return clearInput();}
     if(!/^\d+$/.test(v)){showError('Location');return clearInput();}
     tempLocation=v;currentState='quantity';
     scanInput.classList.add('hidden');triggerEnterBtn.classList.add('hidden');
     rawQuantity='';updateDisplay();quantityContainer.classList.remove('hidden');
   }
 }});

numKeys.forEach(btn=>btn.addEventListener('click',()=>{rawQuantity+=btn.textContent;updateDisplay();}));
delKey.addEventListener('click',()=>{rawQuantity=rawQuantity.slice(0,-1);updateDisplay();});
enterKey.addEventListener('click',()=>{
 if(!rawQuantity)return;
 scannedData.push({item:currentItem,location:tempLocation,quantity:parseInt(rawQuantity,10)});
 saveData();loadTable();
 currentItem='';tempLocation='';rawQuantity='';currentState='item';
 quantityContainer.classList.add('hidden');
 scanInput.classList.remove('hidden');triggerEnterBtn.classList.remove('hidden');
 scanInput.placeholder='Scan/Type Item';clearInput();
});

dataTableBody.addEventListener('click',e=>{
 if(e.target.matches('button.deleteRow')){
   scannedData.splice(+e.target.dataset.index,1);saveData();loadTable();
 }});

document.getElementById('exportCSV').addEventListener('click',()=>{
 let csv='data:text/csv;charset=utf-8,User:,'+displayName.textContent+
 '\\nWarehouse Zone:,'+displayZone.textContent+'\\n\\nItem,Location,Quantity\\n';
 scannedData.forEach(r=>{csv+=r.item+','+r.location+','+r.quantity+'\\n';});
 const uri=encodeURI(csv),a=document.createElement('a');a.href=uri;a.download='scanned_data_'+Date.now()+'.csv';
 document.body.appendChild(a);a.click();document.body.removeChild(a);
});
</script>
</body>
</html>
